language: php
sudo: false

php:
  - 7.1
  - 7.2
  - 7.3

env:
  matrix:
    - DB=sqlite db_dsn='sqlite:///:memory:'

  global:
    - DEFAULT=1
  
matrix:
  fast_finish: true
  include:
    - php: 7.1
      env:
        - COVERAGE=1

before_script:
  - printf "\n" | pecl install imagick
  - composer self-update
  - composer global require hirak/prestissimo
  - composer install --prefer-dist --no-interaction

script:
  - if [[ $DEFAULT = 1 ]]; then composer test; fi
  - if [[ $COVERAGE = 1 ]]; then composer coverage-test; fi

after_success:
  - if [[ $COVERAGE = 1 ]]; then bash <(curl -s https://codecov.io/bash); fi

notifications:
  email: false
